/*
	UIZE JAVASCRIPT FRAMEWORK 2011-04-01

	http://www.uize.com/reference/Uize.Doc.Simple.html
	Available under MIT License or GNU General Public License -- http://www.uize.com/license.html
*/
Uize.module({name:'Uize.Doc.Simple',required:['Uize.Data','Uize.Data.Simple','Uize.String','Uize.Templates.List','Uize.Array.Sort','Uize.Xml'],builder:function(){var _a,_b='string',_c=function(){},_d=Uize.String.limitLength;var _e='[-\\*~:\\.]',_f=new RegExp(_e),_g=new RegExp('^\\s*'+_e+'\\s*$'),_h='([@#\\+a-zA-Z]|\\d+)',_i=new RegExp(_h),_j=new RegExp('^([<\\(\\{\\[]*\\s*'+_h+'?\\s*[>\\)\\}\\]]*\\s*'+_e+'*\\s+)'),_k=/^\s*<<\s*([^<]*?)\s*>>\s*[\n\r]/,_l={html:function(_m){return _m.code;},image:function(_m){var _n=_m.indent,_o=_m.indentChars,_p=Uize.Xml.toAttributeValue(_m.title||''),_q=Uize.Xml.toAttributeValue(_m.subtitle||''),_r=_p&&_q,_s=Uize.Xml.toAttributeValue(_m.url),_t=_p+(_r&&' (')+_q+(_r&&')');return[_n+'<div class="image">',_n+_n+'<a href="'+_s+'">',_n+_n+_n+'<img'+' src="'+_s+'"'+' title="'+_t+'"'+' alt="'+_t+'"'+(_m.width?' width="'+Uize.Xml.toAttributeValue(_m.width)+'"':'')+(_m.height?' height="'+Uize.Xml.toAttributeValue(_m.height)+'"':'')+'/>',_n+_n+'</a>',_n+_n+'<div>',(_p&&
(_n+_n+_n+'<span class="imageTitle">'+_p+'</span>')),(_q&&(_n+_n+_n+'<span class="imageSubtitle">'+_q+'</span>')),_n+_n+'</div>',_n+'</div>'].join('\n');},samplecode:function(_m){return'<pre class="sample-code">'+_u(_m.code||'')+'</pre>';},table:function(_m){var _n=_m.indent,_o=_m.indentChars,_v=[_n+'<table class="data">'],_w=_m.title,_x=_m.data,_y=_x.length;_w&&_v.push(_n+_o+'<tr class="title">',_n+_o+_o+'<td'+(_y?(' colspan="'+_x[0].length+'"'):'')+'>'+_u(_w)+'</td>',_n+_o+'</tr>');for(var _z= -1,_A;++_z<_y;){_v.push(_n+_o+'<tr'+(_z?'':' class="heading"')+'>');_A=_x[_z];for(var _B= -1,_C=_A.length,_D;++_B<_C;)_v.push(_n+_o+_o+'<td>'+_u(_A[_B])+'</td>');_v.push(_n+_o+'</tr>');}_v.push(_n+'</table>');return _v.join('\n');}},_E={47:1,92:1};var _F={};function _G(_H){return(_F[_H]||(_F[_H]=Uize.Data.map('+value',_H.split('_'))));}var _I=_c.build=function(_J){function _K(_L,_M){var _N=_J[_L];return typeof _N==_b?_N:_M;}var _O=_J.data,_P=Uize.copyInto(Uize.Data.getLookup(_a,0,true),_J.urlDictionary),
_Q=_J.pathToRoot||'',_o=_K('indentChars','\t'),_R=_K('headingNumberingSeparator','. '),_S=_K('headingNumberingDelimiter','.'),_T=Uize.defaultNull(_J.maxCssClassLevel,9),_U=[],_V=[0],_W=[],_X={items:[]},_Y={};if(typeof _O==_b)_O=Uize.Data.Simple.parse({simple:_O,parseName:false,ignoreWhitespaceLines:true});function _Z(_O){var _0=_O.children;if(_0.length){var _1=Uize.Data.getLookup(_a,0,true);for(var _2= -1;++_2<_0.length;){var _3=_0[_2],_4=_3.children;if(_4.length){var _5=_3.value,_6=_1[_5];if(_6){_6.children=_6.children.concat(_4);_0.splice(_2,1);_2--;}else{_1[_5]=_3;}}}for(var _2= -1,_7=_0.length;++_2<_7;)_Z(_0[_2]);}}_J.canonicalizePeerSections!==false&&_Z(_O);var _8=_J.sectionsToSort;if(_8){var _9=Uize.Data.getLookup(_8);function _ba(_O){var _0=_O.children,_7=_0.length;if(_7){_9[_O.value]&&Uize.Array.Sort.sortBy(_0,'value.value');for(var _2= -1;++_2<_7;)_ba(_0[_2]);}}_ba(_O);}var _bb=Uize.Data.getLookup(_a,0,true),_bc=Uize.Data.getLookup(_a,0,true),_bd=[0];function _be(_bf,_bg,_H){
(_bf[_bg]||(_bf[_bg]=[])).push(_H);}function _bh(_bf,_bg,_bi){var _H=_bf[_bg];if(_H){var _bj=_H,_bk=_bj.length;_H=_bj[0];if(_bi&&_bk>1){var _bl,_bm;for(var _bn= -1,_bo;++_bn<_bk;){var _U=_G(_H=_bj[_bn]);if(!(_bo= !_bl)){for(var _bp= -1,_bq=_U.length;++_bp<_bq;){var _br=Math.abs(_U[_bp]-(_bi[_bp]||0))-Math.abs((_bm[_bp]||0)-(_bi[_bp]||0));if(_br<0){_bo=true;break;}else if(_br>0){_bo=false;break;}}}if(_bo){_bl=_H;_bm=_U;}}_H=_bl;}}return _H;}function _bs(_O,_bt,_bu){var _0=_O.children;if(_0.length){_bd[_bt]++;var _bv=_O.value+'',_H=_bt?_bu+(_bu&&'_')+_bd[_bt]:'';_be(_bb,_bv,_H);_be(_bc,_bv.toLowerCase(),_H);_bd[_bt+1]=0;for(var _2= -1,_7=_0.length;++_2<_7;)_bs(_0[_2],_bt+1,_H);}}_bs(_O,0,'');function _bw(_bx,_U){function _by(_bz,_bA,_bB,_bC,_bD){if(!_U)return _bA;var _bE=_bC=='url';if(_bC&& !_bE){if(_bC=='text')_bD=_bA;var _H=_bh(_bb,_bD,_U)||_bh(_bc,_bD.toLowerCase(),_U);_H?(_bD='#'+_H):((_bD=_P[_bD]||'')&&(_bE=true));}if(_E[_bD.charCodeAt(0)])_bD=_Q+_bD.slice(1);return(_bz+(_bD?('<a href="'+_bD+'"'+(
_bE&&/^[a-zA-Z]+:/.test(_bD)?' target="_blank" class="externalSiteLink"':'')+'>'+_bA+'</a>'):_bA)+_bB);}return(_bx.replace(/^#(\S*)/,function(_bF,_bG){return _by('<a name="'+_bG+'">','','</a>')}).replace(/\B\*.+?\*\B/g,function(_bF){return _by('<b>',_bF.slice(1,-1),'</b>','text')}).replace(/\b__.+?__\b/g,function(_bF){return _by('<b><i>',_bF.slice(2,-2),'</i></b>','text')}).replace(/\b_.+?_\b/g,function(_bF){return _by('<i>',_bF.slice(1,-1),'</i>','text')}).replace(/\B==.+?==\B/g,function(_bF){return _by('<code><b>',_bF.slice(2,-2),'</b></code>','text')}).replace(/\B=.+?=\B/g,function(_bF){return _by('<code>',_bF.slice(1,-1),'</code>','text')}).replace(/\B`.+?`\B/g,function(_bF){return _by('',_bF.slice(1,-1),'','text')}).replace(/\[\[(#.+?|[a-zA-Z]+:.+?|.+?\.(?:htm|html|jpg|gif|png)(?:[\?#][^\]]*)?)\]\[(.+?)\]\]/g,function(_bF,_bH,_bI){return _by('',_bI,'','url',_bH)}).replace(/\[\[(.+?)\]\[(.+?)\]\]/g,function(_bF,_bJ,_bI){return _by('',_bI,'','section',_bJ)}).replace(/\[\[(#.+?|[a-zA-Z]+?:.+?)\]\]/g,
function(_bF,_bH){return _by('',_bH,'','url',_bH)}).replace(/\[\[(.+?)\]\]/g,function(_bF,_bJ){return _by('',_bJ,'','text')}));}function _bK(_O,_bt,_bL,_bM,_bN,_bO){function _bP(_bQ,_n){_W.push((_n!==false?_bM:'')+_bQ);}function _bR(_bS){var _bT=_bt+ !!_bS;if(_V[_bT]){_bP((_bS?_o:'')+'</table>');_V[_bT]=0;}}var _0=_O.children,_bv=_O.value,_bU;if(!_0.length){if(/\r|\n|\r\n/.test(_bv)){var _bV;_bR();var _bW,_bX,_bY=_bv.match(_k);if(_bY){var _bZ=_bY[1].toLowerCase(),_b0=_bZ=='metadata';if(_b0||(_bW=_l[_bZ])){_bX=Uize.Data.Simple.parse({simple:_bv.slice(_bY[0].length),collapseChildren:true,ignoreWhitespaceLines:true});_b0&&Uize.copyInto(_Y,_bX);}}else{_bW=_l.samplecode;_bX={code:_bv};}if(_bW){_bX.indent=_bM;_bX.indentChars=_o;_bV=_bW(_bX);}if(_bV!=_a){_bP('');_bP(_bV,false);_bP('');}}else if(/^={3,}$/.test(_bv)){_bR();_bP('<hr class="thick"/>');}else if(/^-{3,}$/.test(_bv)){_bR();_bP('<hr class="thin"/>');}else if((_bU=_bv.match(_j))&&/[^\w\s\d]/.test(_bU[1])){var _b1=_bU[1],_b2=_b1.match(_i);_V[_bt]||
_bP('<table class="list">');if(_b2){var _b3=_b2[1],_b4='';if(/[#\+]|\d+/.test(_b3)){_b4=_V[_bt]+1+'';}else if(/[@a-z]/i.test(_b3)){_b4='abcdefghijklmnopqrstuvwxyz'.charAt(_V[_bt]);if(/[A-Z]/.test(_b3))_b4=_b4.toUpperCase();}_b1=_b1.replace(_i,_b4)}else{_b1=_g.test(_b1)?_b1.replace(_f,'<span class="bullet"></span>'):_u(_b1);}_bP('<tr valign="top">'+'<td><span style="white-space:nowrap;">'+_b1+'</span></td>'+'<td>'+_bw(_bv.replace(_j,''),_U)+'</td>'+'</tr>');_V[_bt]++;}else{_bR();var _b5=_bw(_bv,_U);if(/[A-Z]/.test(_b5)&& !/[a-z]/.test(_b5))_b5='<span class="allCaps">'+_b5+'</span>';_bP('<p>'+_b5+'</p>');_bP('');}}else{_bR();_U[_bt-1]++;var _b6=Math.min(_bt,_T),_b7=_bt>0&&true,_b8=_b7?_U.join('_'):'',_b9=(_U.length?_U.join(_S)+_R:'')+_bv,_ca=(_bN?(_bN+' -> '):'')+_b9,_cb=' title="'+Uize.Xml.toAttributeValue(_ca)+'"',_cc=_b7?((_bO?(_bO+_S):'')+'<a href="#'+_b8+'"'+_cb+'>'+_U[_bt-1]+'</a>'):'',_cd={title:_b9||'Contents',description:_0[0].children.length?'':_d(_bw(_0[0].value),400),link:_b8?('#'+_b8):'',items:[]};
_bL.items.push(_cd);if(_bv){var _ce='h'+Math.min(_bt,5),_cf=_cc+_R;_bP('<a name="'+_b8+'"></a>');_bP('<'+_ce+' class="heading'+_b6+'"'+_cb+'>'+(_cc?'<span class="headingNumber">'+_cf+'</span>':'')+_bv+'</'+_ce+'>');}_bP('<div class="contents'+_b6+'">');_U[_bt]=_V[_bt+1]=0;for(var _2= -1,_7=_0.length;++_2<_7;)_bK(_0[_2],_bt+1,_cd,_bM+_o,_ca,_cc);_bR(true);/\S/.test(_W[_W.length-1])||_W.pop();_bP('</div>');_bP('');_U.length=_bt;}}_bK(_O,0,_X,'','','');var _cg=_X.items,_ch=(_J.contentsList!==false&&(_cg.length&&(_cg.length>1||_cg[0].items.length))?('<div id="page_contents" class="contents-tree-shell">\n'+Uize.Templates.List.process({items:_cg})+'\n'+'</div>\n'+'\n'):'')+_W.join('\n');return(_J.result=='full'?{html:_ch,contentsTreeItems:_cg,metaData:_Y}:_ch);};_c.toDocument=function(_ci,_cj){return _I(Uize.copyInto({data:_ci},_cj));};var _u=_c.toSampleCode=function(_ck){return _ck.replace(/\t/g,'  ').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');};return _c;}});